<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Event Details - Artist Hub</title>
        <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        <link rel="stylesheet" href="events.css">
        <link rel="icon" href="https://github.com/Larkaholic/ArtistHub-BaguioCity/blob/master/images/artisthubLogo.png?raw=true" type="image/x-icon">

        <!--Added For Disable Right Click-->
        <script>document.addEventListener('contextmenu', function(e) {
            if (e.target.tagName === 'IMG', 'VIDEO') {
                e.preventDefault();
            }
        });</script>

    </head>
    <body class="bg-cover">
        <!-- Header/Navbar - Updated to match index.html -->
        <header class="fixed flex justify-between items-center top-0 left-0 right-0 z-50 p-1 transparent-header" id="main-header">
            <div class="flex w-24 ml-16">
                <img src="https://raw.githubusercontent.com/Larkaholic/ArtistHub-BaguioCity/master/images/artisthubLogo.png" alt="HeaderLogo" onclick="navToEvent('../index.html')" style="cursor: pointer; height: 50px;">
            </div>
        
            <div class="sm:hidden flex items-center mr-5">
                <button onclick="toggleNav()" class="burger-icon">
                    <svg class="w-8 h-8 text-black" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        
            <nav class="hidden sm:flex sm:items-center sm:space-x-5 mr-5">
                <ul class="text-black text-md flex space-x-5 text-xl font-semibold">
                    <li class="nav-item p-1 rounded-lg">
                        <a href="javascript:void(0)" onclick="navToEvent('../index.html')">Home</a>
                    </li>
                    <li class="nav-item p-1 rounded-lg">
                        <a href="javascript:void(0)" onclick="navToEvent('../index.html#events')">Events</a>
                    </li>
                    <li class="nav-item p-1 rounded-lg">
                        <a href="javascript:void(0)" onclick="navToEvent('../shop/shop.html')">Shop</a>
                    </li>
                    <li class="nav-item p-1 rounded-lg">
                        <a href="javascript:void(0)" onclick="handleEditProfile()">Profile</a>
                    </li>
                </ul>
                <ul class="text-black text-md flex space-x-5 text-xl font-semibold">
                    <li class="nav-item hover:bg-green-500 p-1 rounded-lg admin-button" style="display: none;">
                        <a href="javascript:void(0)" onclick="navToEvent('../admin/dashboard.html')">Admin</a>
                    </li>
                    <li class="login-button">
                        <button onclick="toggleLoginFlyout(event)" class="nav-item bg-blue-500 text-white p-1 px-2 rounded-lg font-semibold hover:bg-blue-600">Login</button>
                    </li>
                    <!-- Update the profile button to fix click handling -->
                    <li class="profile-dropdown-container" style="display: none;">
                        <div class="relative">
                            <button id="profileButton" class="profile-button flex items-center" onclick="toggleProfileDropdown(event)">
                                <img id="userProfilePic" src="https://raw.githubusercontent.com/Larkaholic/ArtistHub-BaguioCity/master/images/defaultProfile.png" 
                                     alt="Profile" 
                                     class="w-10 h-10 rounded-full object-cover border-2 border-green-500">
                            </button>
                            <div id="profileDropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl z-[1000]">
                                <div class="py-2">
                                    <div class="px-4 py-2 border-b border-gray-200 text-center">
                                        <p class="text-sm font-semibold text-gray-700" id="profileDropdownName">Loading...</p>
                                        <p class="text-xs text-gray-500" id="profileDropdownEmail">Loading...</p>
                                    </div>
                                    <a href="javascript:void(0)" onclick="navigateToUserProfile()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-center">View Profile</a>
                                    <a href="javascript:void(0)" onclick="openSettingsModal()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-center">Settings</a>
                                    <a href="javascript:void(0)" onclick="handleLogout()" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100 text-center">Logout</a>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </nav>
        </header>

        <!-- Mobile Nav Menu - Updated to match index.html -->
        <div id="flyout-menu" class="fixed top-0 right-0 w-64 h-screen transform translate-x-full transition-transform duration:300 ease-in-out z-40 sm:hidden">
            <div class="glass-header h-full p-6">
                <nav>
                    <ul class="flex flex-col space-y-4 mt-5">
                        <li><a href="javascript:void(0)" onclick="navToEvent('../index.html')">Home</a></li>
                        <li><a href="javascript:void(0)" onclick="navToEvent('../index.html#events')">Events</a></li>
                        <li><a href="javascript:void(0)" onclick="navToEvent('../shop/shop.html')">Shop</a></li>
                        <li class="relative">
                            <button id="profileLinkMobile" class="flex items-center w-full">
                                <img src="https://raw.githubusercontent.com/Larkaholic/ArtistHub-BaguioCity/master/images/defaultProfile.png" 
                                     alt="Profile" 
                                     class="w-8 h-8 rounded-full object-cover border-2 border-green-500 mr-2">
                                <span>Profile</span>
                            </button>
                            <div id="mobileProfileDropdown" class="hidden mt-2 bg-white rounded-lg shadow-lg border-2 border-black">
                                <div class="px-4 py-3 border-b border-gray-200 text-center">
                                    <p id="mobileProfileName" class="text-sm font-semibold text-gray-700">Loading...</p>
                                    <p id="mobileProfileEmail" class="text-xs text-gray-500">Loading...</p>
                                </div>
                                <div class="py-2">
                                    <a href="javascript:void(0)" onclick="navigateToUserProfile()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-center">View Profile</a>
                                    <a href="javascript:void(0)" onclick="openSettingsModal()" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 text-center">Settings</a>
                                </div>
                            </div>
                        </li>
                        <li class="nav-item hover:bg-green-500 p-1 rounded-lg admin-button" style="display: none;">
                            <a href="javascript:void(0)" onclick="navToEvent('../admin/dashboard.html')">Admin</a>
                        </li>
                        <li class="login-button">
                            <button onclick="toggleLoginFlyout(event)" class="py-2 px-4 bg-blue-500 text-white rounded-lg w-full">Login</button>
                        </li>
                        <li class="logout-button" style="display: none;">
                            <button onclick="handleLogout()" class="py-2 px-4 bg-red-500 text-white rounded-lg w-full">Logout</button>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- Login Flyout -->
        <div id="LoginFlyout" class="flyout fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-50 z-50 hidden">
            <!-- Login Form -->
            <div id="loginForm" class="glass-header2 items-center rounded-lg w-96 mx-10">
                <h2 class="flex justify-center font-bold text-2xl my-4">Login</h2>
                <form id="loginFormElement" onsubmit="handleLogin(event)">
                    <div class="mx-2 mb-4">
                        <label for="loginEmail" class="block font-medium">Email:</label>
                        <input type="email" id="loginEmail" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" placeholder="Enter Email" required>
                    </div>
                    <div class="mx-2 mb-4">
                        <label for="loginPassword" class="block font-medium">Password:</label>
                        <input type="password" id="loginPassword" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" placeholder="Enter Password" required>
                    </div>
                    <div class="flex items-center justify-between mx-20 my-5">
                        <button type="submit" class="glass-header text-black py-2 px-4 rounded-md hover:bg-gray-300">Login</button>
                        <button type="button" class="glass-header text-black py-2 px-4 rounded-md hover:bg-gray-300" onclick="toggleLoginFlyout()">Close</button>
                    </div>
                    <div class="text-center mb-4">
                        <p>Need an account? <a href="javascript:void(0)" onclick="toggleForms()" class="underline">SIGN UP</a></p>
                    </div>
                </form>
            </div>
            <!-- register -->
            <div id="registerForm" class="glass-header2 items-center rounded-lg w-96 mx-10 hidden">
                <h2 class="flex justify-center font-bold text-2xl my-4">Register</h2>
                <form onsubmit="return handleRegister(event)">
                    <div class="mx-2 mb-4">
                        <label for="registerEmail" class="block font-medium">Email:</label>
                        <input type="email" id="registerEmail" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" placeholder="Enter Email" required>
                    </div>
                    <div class="mx-2 mb-4">
                        <label for="registerPassword" class="block font-medium">Password:</label>
                        <input type="password" id="registerPassword" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" placeholder="Enter Password" required>
                    </div>
                    <div class="mx-2 mb-4">
                        <label for="userType" class="block font-medium">Account Type:</label>
                        <select id="userType" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" required>
                            <option value="user">Regular User</option>
                            <option value="artist">Artist</option>
                        </select>
                    </div>
                    <div class="flex items-center justify-between mx-20 my-5">
                        <button type="submit" class="glass-header text-black py-2 px-4 rounded-md hover:bg-gray-300">Register</button>
                        <button type="button" class="glass-header text-black py-2 px-4 rounded-md hover:bg-gray-300" onclick="toggleLoginFlyout()">Close</button>
                    </div>
                    <div class="text-center mb-4">
                        <p>Already have an account? <a href="javascript:void(0)" onclick="toggleForms()" class="underline">LOGIN</a></p>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Settings Modal from index.html -->
        <div id="settingsModal" class="fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-50 z-10 hidden">
            <div class="glass-header items-center rounded-lg w-96 mx-10 p-6 relative bg-white shadow-xl">
                <button onclick="closeSettingsModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
                <div id="settingsMainView">
                    <h2 class="text-center font-bold text-2xl mb-6">Account Settings</h2>
                    <div class="flex flex-col gap-4">
                        <button onclick="handleEditProfile()" class="py-4 px-6 rounded-lg hover:bg-gray-100 transition-all border-2 border-green-500 hover:border-green-600 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                            <div class="text-left">
                                <h3 class="font-bold text-lg">Edit Profile</h3>
                                <p class="text-sm text-gray-600">Update your personal information</p>
                            </div>
                        </button>
                        <button onclick="showPasswordChangeForm()" class="py-4 px-6 rounded-lg hover:bg-gray-100 transition-all border-2 border-blue-500 hover:border-blue-600 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                            <div class="text-left">
                                <h3 class="font-bold text-lg">Change Password</h3>
                                <p class="text-sm text-gray-600">Update your account security</p>
                            </div>
                        </button>
                    </div>
                </div>
                <div id="passwordChangeForm" class="hidden">
                    <h2 class="text-center font-bold text-2xl mb-6">Change Password</h2>
                    <!-- Add error and success message containers -->
                    <div id="passwordChangeError" class="hidden p-4 mb-4 text-red-700 bg-red-100 rounded-lg"></div>
                    <div id="passwordChangeSuccess" class="hidden p-4 mb-4 text-green-700 bg-green-100 rounded-lg"></div>
                    
                    <form onsubmit="submitPasswordChange(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Current Password</label>
                            <input type="password" id="currentPassword" required 
                                   class="mt-1 block w-full rounded-md border-2 border-gray-300 p-2 focus:border-green-500 focus:ring focus:ring-green-200">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">New Password</label>
                            <input type="password" id="newPassword" required 
                                   pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,}$"
                                   class="mt-1 block w-full rounded-md border-2 border-gray-300 p-2 focus:border-green-500 focus:ring focus:ring-green-200">
                            <p class="mt-1 text-sm text-gray-500">
                                Password must be at least 8 characters and include:
                                <br>• One uppercase letter
                                <br>• One lowercase letter
                                <br>• One number
                            </p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Confirm New Password</label>
                            <input type="password" id="confirmPassword" required 
                                   class="mt-1 block w-full rounded-md border-2 border-gray-300 p-2 focus:border-green-500 focus:ring focus:ring-green-200">
                        </div>
                        <div class="flex justify-between pt-4">
                            <button type="button" onclick="hidePasswordChangeForm()" 
                                    class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                                Back
                            </button>
                            <button type="submit" 
                                    class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">
                                Update Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <main class="container mx-auto mt-24 p-4">
            <!-- Add Event Request Button -->
            <div class="flex justify-end items-center mb-6">
                <button onclick="openEventRequestModal()" class="glass-header px-6 py-3 rounded-lg text-black font-semibold hover:bg-green-100 transition-all flex items-center shadow-md transform hover:scale-105">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                    </svg>
                    Request to Add Your Event
                </button>
            </div>
            
            <!-- Event Details Container -->
            <div id="eventDetails" class="eventt glass-header rounded-lg p-8">
                <!-- Event details will be loaded here -->
                <div class="animate-pulse">
                    <div class="h-8 bg-white/20 rounded w-3/4 mb-4"></div>
                    <div class="h-4 bg-white/20 rounded w-1/2 mb-2"></div>
                    <div class="h-4 bg-white/20 rounded w-1/3"></div>
                </div>
            </div>
        </main>

        <!-- Add Event Request Modal -->
        <div id="eventRequestModal" class="fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-50 z-50 hidden">
            <div class="glass-header rounded-lg w-full max-w-lg mx-4 p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">Request to Add Event</h2>
                    <button onclick="closeEventRequestModal()" class="text-gray-500 hover:text-gray-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                
                <form id="eventRequestForm" onsubmit="submitEventRequest(event)" class="space-y-4">
                    <div>
                        <label for="eventTitle" class="block font-medium">Event Title:</label>
                        <input type="text" id="eventTitle" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" required>
                    </div>
                    
                    <div>
                        <label for="eventDate" class="block font-medium">Event Date:</label>
                        <input type="date" id="eventDate" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" required>
                    </div>
                    
                    <div>
                        <label for="eventLocation" class="block font-medium">Event Location:</label>
                        <input type="text" id="eventLocation" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" required>
                    </div>
                    
                    <div>
                        <label for="eventDescription" class="block font-medium">Event Description:</label>
                        <textarea id="eventDescription" rows="4" class="block mt-1 p-2 border border-gray-400 rounded-md w-full resize-none" required></textarea>
                    </div>
                    
                    <div>
                        <label for="contactEmail" class="block font-medium">Contact Email:</label>
                        <input type="email" id="contactEmail" class="block mt-1 p-2 border border-gray-400 rounded-md w-full" required>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="closeEventRequestModal()" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <!-- <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">
                            Submit Request
                        </button> -->
                    </div>
                </form>
            </div>
        </div>

        <!-- Scripts -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <!-- Firebase -->
        <script type="module" src="../js/firebase-config.js"></script>
        <!-- Modules -->
        <script type="module" src="../js/auth.js"></script>
        <script type="module" src="../js/navigation.js"></script>
        <script type="module" src="./events.js"></script>
        <script type="module" src="../js/password-change.js"></script>
        <script type="module" src="../js/profile-navigation.js"></script>
        <script type="module" src="../js/profileDropdown.js"></script>

        <script>
            function toggleNav() {
                const menu = document.getElementById('flyout-menu');
                menu.classList.toggle('translate-x-full');
            }

            async function handleLogin(event) {
                event.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                try {
                    const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                    console.log('Login successful:', userCredential);
                    // Redirect to profile page or show success message
                    window.location.href = 'profile/profile.html';
                } catch (error) {
                    console.error('Login failed:', error);
                    alert('Login failed: ' + error.message);
                }
            }

            async function handleLogout() {
                try {
                    await firebase.auth().signOut();
                    console.log('Logout successful');
                    // Redirect to home page or show success message
                    window.location.href = 'index.html';
                } catch (error) {
                    console.error('Logout failed:', error);
                    alert('Logout failed: ' + error.message);
                }
            }

            function toggleLoginFlyout(event) {
                if (event) event.preventDefault();
                const flyout = document.getElementById('LoginFlyout');
                flyout.classList.toggle('hidden');
            }

            function toggleForms() {
                const loginForm = document.getElementById('loginForm');
                const registerForm = document.getElementById('registerForm');
                loginForm.classList.toggle('hidden');
                registerForm.classList.toggle('hidden');
            }

            function navToEvent(path) {
                const baseUrl = window.location.hostname.includes('github.io') 
                    ? '/ArtistHub-BaguioCity'
                : '';   
                window.location.href = baseUrl + '/' + path;
            }

            // Function to handle event addition request
            function requestAddEvent() {
                openEventRequestModal();
            }
        </script>
        <script type="module">
            // Import auth at the top level of module script
            import { auth } from '../js/firebase-config.js';

            // Make handleProfileClick available globally
            window.handleProfileClick = function() {
                if (auth.currentUser) {
                    window.location.href = `../profile/profile.html?id=${auth.currentUser.uid}`;
                } else {
                    toggleLoginFlyout();
                }
            }

            // Update mobile menu profile link
            document.addEventListener('DOMContentLoaded', function() {
                const mobileProfileLink = document.getElementById('profileLink');
                if (mobileProfileLink) {
                    mobileProfileLink.onclick = () => {
                        if (auth.currentUser) {
                            window.location.href = `../profile/profile.html?id=${auth.currentUser.uid}`;
                        } else {
                            toggleLoginFlyout();
                        }
                    };
                }
            });
        </script>
        <script>
            // Function to handle navigation events
            function navToEvent(url) {
                window.location.href = url;
            }
        
            window.navToEvent = navToEvent;
        </script>

        <script>
            // ...existing code...

            // Add profile dropdown functions from index.html
            function toggleProfileDropdown(event) {
                event.preventDefault();
                const dropdown = document.getElementById('profileDropdown');
                dropdown.classList.toggle('hidden');
            }

            function openSettingsModal() {
                document.getElementById('settingsModal').classList.remove('hidden');
            }

            function closeSettingsModal() {
                document.getElementById('settingsModal').classList.add('hidden');
            }

            function showPasswordChangeForm() {
                document.getElementById('settingsMainView').classList.add('hidden');
                document.getElementById('passwordChangeForm').classList.remove('hidden');
            }

            function hidePasswordChangeForm() {
                document.getElementById('settingsMainView').classList.remove('hidden');
                document.getElementById('passwordChangeForm').classList.add('hidden');
            }

            async function submitPasswordChange(event) {
                event.preventDefault();
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (newPassword !== confirmPassword) {
                    alert('New passwords do not match');
                    return;
                }

                try {
                    await window.handlePasswordChange(currentPassword, newPassword);
                    event.target.reset();
                    hidePasswordChangeForm();
                } catch (error) {
                    console.error('Password change failed:', error);
                }
            }
        </script>

        <!-- Add profile dropdown functionality module -->
        <script type="module">
            import { initProfileDropdown } from '../js/profileDropdown.js';
            import { auth } from '../js/firebase-config.js';
            
            window.navigateToUserProfile = async () => {
                try {
                    const user = auth.currentUser;
                    if (!user) {
                        alert('Please login to view your profile');
                        toggleLoginFlyout();
                        return;
                    }
                    
                    const baseUrl = window.location.hostname === 'larkaholic.github.io' 
                        ? '/ArtistHub-BaguioCity'
                        : '';
                    
                    const profileUrl = `${baseUrl}/profile/profile.html?id=${auth.currentUser.uid}`;
                    window.location.href = profileUrl;
                } catch (error) {
                    console.error('Profile navigation error:', error);
                    alert('There was an error accessing your profile. Please try again.');
                }
            };
            
            window.handleEditProfile = async () => {
                try {
                    const user = auth.currentUser;
                    if (!user) {
                        alert('Please login to edit your profile');
                        toggleLoginFlyout();
                        return;
                    }
                    
                    const baseUrl = window.location.hostname === 'larkaholic.github.io' 
                        ? '/ArtistHub-BaguioCity'
                        : '';
                    
                    const editProfileUrl = `${baseUrl}/profile/edit-profile.html?id=${auth.currentUser.uid}`;
                    window.location.href = editProfileUrl;
                } catch (error) {
                    console.error('Profile navigation error:', error);
                    alert('There was an error accessing your profile. Please try again.');
                }
            };

            document.addEventListener('DOMContentLoaded', function() {
                initProfileDropdown();
                
                // Setup auth state observer to update UI
                auth.onAuthStateChanged((user) => {
                    const loginButtons = document.querySelectorAll('.login-button');
                    const profileDropdowns = document.querySelectorAll('.profile-dropdown-container');
                    const logoutButtons = document.querySelectorAll('.logout-button');
                    const adminButtons = document.querySelectorAll('.admin-button');
                    
                    if (user) {
                        // User is signed in
                        loginButtons.forEach(btn => btn.style.display = 'none');
                        profileDropdowns.forEach(dropdown => dropdown.style.display = 'block');
                        logoutButtons.forEach(btn => btn.style.display = 'block');
                        
                        // Check if admin
                        checkAdminStatus(user.uid);
                    } else {
                        // User is signed out
                        loginButtons.forEach(btn => btn.style.display = 'block');
                        profileDropdowns.forEach(dropdown => dropdown.style.display = 'none');
                        logoutButtons.forEach(btn => btn.style.display = 'none');
                        adminButtons.forEach(btn => btn.style.display = 'none');
                    }
                });
                
                // Check if user is admin
                async function checkAdminStatus(uid) {
                    try {
                        const { getDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
                        const { db } = await import('../js/firebase-config.js');
                        
                        const userDoc = await getDoc(doc(db, 'users', uid));
                        if (userDoc.exists() && userDoc.data().userType === 'admin') {
                            const adminButtons = document.querySelectorAll('.admin-button');
                            adminButtons.forEach(btn => btn.style.display = 'block');
                        }
                    } catch (error) {
                        console.error('Error checking admin status:', error);
                    }
                }
            });
        </script>

        <!-- Update the profile-button to ensure the click event works properly -->
        <script>
            // ...existing code...

            // Fix the profile dropdown toggle function
            function toggleProfileDropdown(event) {
                if (event) event.preventDefault();
                const dropdown = document.getElementById('profileDropdown');
                if (dropdown) {
                    dropdown.classList.toggle('hidden');
                    
                    // Add event listener to close dropdown when clicking elsewhere
                    if (!dropdown.classList.contains('hidden')) {
                        setTimeout(() => {
                            document.addEventListener('click', closeDropdownOnClickOutside);
                        }, 100);
                    }
                }
            }
            
            // Function to close dropdown when clicking outside
            function closeDropdownOnClickOutside(event) {
                const dropdown = document.getElementById('profileDropdown');
                const profileButton = document.querySelector('.profile-button');
                
                if (dropdown && profileButton && 
                    !dropdown.contains(event.target) && 
                    !profileButton.contains(event.target)) {
                    dropdown.classList.add('hidden');
                    document.removeEventListener('click', closeDropdownOnClickOutside);
                }
            }

            // Ensure mobile profile dropdown works too
            document.addEventListener('DOMContentLoaded', function() {
                const profileLinkMobile = document.getElementById('profileLinkMobile');
                const mobileProfileDropdown = document.getElementById('mobileProfileDropdown');
                
                if (profileLinkMobile && mobileProfileDropdown) {
                    profileLinkMobile.addEventListener('click', function(e) {
                        e.preventDefault();
                        mobileProfileDropdown.classList.toggle('hidden');
                    });
                }
            });
        </script>


        <style>

            /* Ensure the dropdown is visible when shown */
            #profileDropdown {
                min-width: 200px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
                border: 1px solid rgba(0, 0, 0, 0.1);
                z-index: 1000;
            }
            
            /* Fix for mobile dropdown */
            #mobileProfileDropdown {
                z-index: 1000;
            }

            .profile-button {
                position: relative;
                cursor: pointer;
            }
            
            .profile-dropdown-container {
                position: relative;
            }
            
            #profileDropdown a,
            #mobileProfileDropdown a {
                display: block;
                text-align: center;
                padding: 8px 16px;
                transition: all 0.2s ease;
            }
            
            #profileDropdown a:hover,
            #mobileProfileDropdown a:hover {
                background-color: rgba(0, 0, 0, 0.05);
                transform: translateY(-1px);
            }
        </style>

        <script>
            // Immediately execute to ensure function is defined
            (function() {
                // Direct DOM attachment for profile dropdown toggle
                window.toggleProfileDropdown = function(event) {
                    console.log("Profile dropdown toggle clicked");
                    if (event) event.preventDefault();
                    const dropdown = document.getElementById('profileDropdown');
                    if (dropdown) {
                        dropdown.classList.toggle('hidden');
                        console.log("Dropdown visibility toggled:", !dropdown.classList.contains('hidden'));
                        
                        // Add event listener to close dropdown when clicking elsewhere
                        if (!dropdown.classList.contains('hidden')) {
                            setTimeout(() => {
                                document.addEventListener('click', closeDropdownOnClickOutside);
                            }, 100);
                        }
                    } else {
                        console.error("Profile dropdown element not found");
                    }
                };
                
                window.closeDropdownOnClickOutside = function(event) {
                    const dropdown = document.getElementById('profileDropdown');
                    const profileButton = document.getElementById('profileButton');
                    
                    if (dropdown && profileButton && 
                        !dropdown.contains(event.target) && 
                        !profileButton.contains(event.target)) {
                        dropdown.classList.add('hidden');
                        document.removeEventListener('click', closeDropdownOnClickOutside);
                    }
                };
                
                // Additional initialization on DOM load
                document.addEventListener('DOMContentLoaded', function() {
                    console.log("DOM loaded, initializing dropdowns");
                    
                    // Ensure profile button has click handler
                    const profileButton = document.getElementById('profileButton');
                    if (profileButton) {
                        console.log("Profile button found, adding click handler");
                        profileButton.addEventListener('click', toggleProfileDropdown);
                    } else {
                        console.error("Profile button element not found");
                    }
                    
                    // Mobile profile button handling
                    const profileLinkMobile = document.getElementById('profileLinkMobile');
                    const mobileProfileDropdown = document.getElementById('mobileProfileDropdown');
                    
                    if (profileLinkMobile && mobileProfileDropdown) {
                        console.log("Mobile profile elements found, adding click handler");
                        profileLinkMobile.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            mobileProfileDropdown.classList.toggle('hidden');
                        });
                    }
                });
            })();
        </script>
        <style>
            #profileDropdown {
                display: block;
                min-width: 200px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
                border: 1px solid rgba(0, 0, 0, 0.1);
                z-index: 2000 !important;
                position: absolute !important;
                right: 0;
                top: 100%;
                background-color: white;
            }
            
            #profileDropdown.hidden {
                display: none !important;
            }
            
            /* Make button clearly interactive */
            .profile-button {
                position: relative;
                cursor: pointer !important;
                z-index: 1500;
                padding: 2px;
                border-radius: 50%;
                transition: all 0.2s;
            }
            
            .profile-button:hover {
                transform: scale(1.05);
                box-shadow: 0 0 5px rgba(0,0,0,0.2);
            }
            
            /* Container positioning */
            .profile-dropdown-container {
                position: relative !important;
            }
        </style>

        <script>
            // Immediately execute to ensure function is defined
            (function() {
                // Direct DOM attachment for profile dropdown toggle
                window.toggleProfileDropdown = function(event) {
                    console.log("Profile dropdown toggle clicked");
                    if (event) event.preventDefault();
                    const dropdown = document.getElementById('profileDropdown');
                    if (dropdown) {
                        dropdown.classList.toggle('hidden');
                        console.log("Dropdown visibility toggled:", !dropdown.classList.contains('hidden'));
                        
                        // Add event listener to close dropdown when clicking elsewhere
                        if (!dropdown.classList.contains('hidden')) {
                            setTimeout(() => {
                                document.addEventListener('click', closeDropdownOnClickOutside);
                            }, 100);
                        }
                    } else {
                        console.error("Profile dropdown element not found");
                    }
                };
                
                window.closeDropdownOnClickOutside = function(event) {
                    const dropdown = document.getElementById('profileDropdown');
                    const profileButton = document.getElementById('profileButton');
                    
                    if (dropdown && profileButton && 
                        !dropdown.contains(event.target) && 
                        !profileButton.contains(event.target)) {
                        dropdown.classList.add('hidden');
                        document.removeEventListener('click', closeDropdownOnClickOutside);
                    }
                };
                
                // Additional initialization on DOM load
                document.addEventListener('DOMContentLoaded', function() {
                    console.log("DOM loaded, initializing dropdowns");
                    
                    // Ensure profile button has click handler
                    const profileButton = document.getElementById('profileButton');
                    if (profileButton) {
                        console.log("Profile button found, adding click handler");
                        profileButton.addEventListener('click', toggleProfileDropdown);
                    } else {
                        console.error("Profile button element not found");
                    }
                    
                    // Mobile profile button handling
                    const profileLinkMobile = document.getElementById('profileLinkMobile');
                    const mobileProfileDropdown = document.getElementById('mobileProfileDropdown');
                    
                    if (profileLinkMobile && mobileProfileDropdown) {
                        console.log("Mobile profile elements found, adding click handler");
                        profileLinkMobile.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            mobileProfileDropdown.classList.toggle('hidden');
                        });
                    }
                });
            })();
        </script>

        <script>
    // ...existing code...

    // Function to open the event request modal
    function openEventRequestModal() {
        // Check if user is logged in
        import('../js/firebase-config.js').then(module => {
            const { auth } = module;
            if (auth.currentUser) {
                // If logged in, show modal and pre-fill email
                const modal = document.getElementById('eventRequestModal');
                const emailField = document.getElementById('contactEmail');
                
                // Pre-fill email with user's email
                emailField.value = auth.currentUser.email || '';
                
                // Show the modal
                modal.classList.remove('hidden');
            } else {
                // If not logged in, show login modal
                alert('Please log in to request adding an event');
                toggleLoginFlyout();
            }
        }).catch(error => {
            console.error('Error importing auth:', error);
            alert('Please log in to request adding an event');
            toggleLoginFlyout();
        });
    }
    
    // Function to close the event request modal
    function closeEventRequestModal() {
        const modal = document.getElementById('eventRequestModal');
        modal.classList.add('hidden');
    }
    
    // Function to handle form submission
    async function submitEventRequest(event) {
        event.preventDefault();
        
        try {
            // Import Firebase modules
            const { db, auth } = await import('../js/firebase-config.js');
            const { collection, addDoc, serverTimestamp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
            
            // Get form values
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const location = document.getElementById('eventLocation').value;
            const description = document.getElementById('eventDescription').value;
            const email = document.getElementById('contactEmail').value;
            
            // Create event request object
            const eventRequest = {
                title,
                date,
                location,
                description,
                contactEmail: email,
                status: 'pending', // Default status for new requests
                userId: auth.currentUser ? auth.currentUser.uid : null,
                createdAt: serverTimestamp()
            };
            
            // Add document to "eventRequests" collection
            await addDoc(collection(db, 'eventRequests'), eventRequest);
            
            // Close modal and show success message
            closeEventRequestModal();
            alert('Your event request has been submitted and is pending approval.');
            
            // Reset form
            document.getElementById('eventRequestForm').reset();
            
        } catch (error) {
            console.error('Error submitting event request:', error);
            alert('There was an error submitting your request. Please try again.');
        }
    }
    
    // Connect the requestAddEvent function to the openEventRequestModal function
    function requestAddEvent() {
        openEventRequestModal();
    }
</script>

    </body>
</html>